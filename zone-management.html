<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zone Management - PRO-SAFE</title>
    <link href="https://fonts.googleapis.com/css?family=Inter:400,500,600,700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root { --primary-color: #2c5b89; --primary-dark: #1e4062; --secondary-color: #f0b178; --success-color: #28a745; --danger-color: #dc3545; --border-color: #e9ecef; --shadow-md: 0 4px 12px rgba(0,0,0,0.15); --border-radius: 8px; --border-radius-lg: 12px; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); color: #333; line-height: 1.6; }
        .dashboard-container { display: flex; flex-direction: column; min-height: 100vh; }
        .header { background: linear-gradient(135deg, var(--primary-color), var(--primary-dark)); color: #fff; display: flex; align-items: center; padding: 0 32px; height: 72px; box-shadow: var(--shadow-md); }
        .logo { display: flex; align-items: center; font-size: 2rem; font-weight: bold; }
        .logo-img { width: 48px; height: 48px; margin-right: 12px; border-radius: 50%; padding: 4px; background: #2c5b89; }
        .main-content { flex: 1; padding: 32px; max-width: 1400px; margin: 0 auto; width: 100%; }
        .page-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 32px; }
        .page-title { font-size: 2rem; font-weight: 700; color: #2c5b89; }
        .btn { padding: 14px 28px; border: none; border-radius: var(--border-radius); font-size: 1rem; font-weight: 600; cursor: pointer; display: inline-flex; align-items: center; gap: 8px; transition: all 0.2s; }
        .btn-primary { background: linear-gradient(135deg, var(--primary-color), var(--primary-dark)); color: #fff; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: var(--shadow-md); }
        .btn-secondary { background: #6c757d; color: #fff; }
        .btn-danger { background: var(--danger-color); color: #fff; }
        .zones-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); gap: 24px; margin-bottom: 32px; }
        .zone-card { background: #fff; border-radius: var(--border-radius-lg); box-shadow: var(--shadow-md); overflow: hidden; transition: all 0.3s; border: 1px solid var(--border-color); }
        .zone-card:hover { transform: translateY(-4px); box-shadow: 0 8px 24px rgba(0,0,0,0.2); }
        .zone-header { background: linear-gradient(135deg, var(--primary-color), var(--primary-dark)); color: #fff; padding: 24px; position: relative; }
        .zone-title { font-size: 1.4rem; font-weight: 700; margin-bottom: 8px; }
        .zone-id { font-size: 0.9rem; opacity: 0.8; font-family: 'Courier New', monospace; }
        .zone-actions { position: absolute; top: 16px; right: 16px; display: flex; gap: 8px; }
        .action-btn { background: rgba(255,255,255,0.2); border: none; color: #fff; width: 32px; height: 32px; border-radius: 4px; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .action-btn:hover { background: rgba(255,255,255,0.3); }
        .zone-content { padding: 20px; }
        .device-section { margin-bottom: 20px; }
        .section-title { font-size: 1.1rem; font-weight: 600; color: #2c5b89; margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }
        .device-list { display: flex; flex-wrap: wrap; gap: 8px; }
        .device-tag { background: #f8f9fa; color: #6c757d; padding: 8px 16px; border-radius: 20px; font-size: 0.9rem; font-weight: 500; border: 1px solid var(--border-color); }
        .device-tag.camera { background: linear-gradient(135deg, #e3f2fd, #bbdefb); color: #1976d2; border-color: #90caf9; }
        .device-tag.deterrent { background: linear-gradient(135deg, #fff3e0, #ffe0b2); color: #f57c00; border-color: #ffcc02; }
        .zone-stats { display: flex; justify-content: space-between; padding: 16px 20px; background: #f8f9fa; border-top: 1px solid #e9ecef; }
        .stat { text-align: center; }
        .stat-value { font-size: 1.5rem; font-weight: 700; color: #2c5b89; }
        .stat-label { font-size: 0.8rem; color: #6c757d; text-transform: uppercase; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; }
        .modal.show { display: flex; align-items: center; justify-content: center; }
        .modal-content { background: #fff; border-radius: var(--border-radius-lg); padding: 32px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
        .modal-title { font-size: 1.5rem; font-weight: 700; color: #2c5b89; }
        .close-btn { background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #6c757d; }
        .form-group { margin-bottom: 20px; }
        .form-label { display: block; margin-bottom: 8px; font-weight: 600; color: #495057; }
        .form-input { width: 100%; padding: 16px; border: 2px solid var(--border-color); border-radius: var(--border-radius); font-size: 1rem; }
        .form-input:focus { outline: none; border-color: var(--primary-color); }
        .device-selection { border: 2px solid var(--border-color); border-radius: var(--border-radius); padding: 20px; max-height: 250px; overflow-y: auto; background: #f8f9fa; }
        .device-category { margin-bottom: 16px; }
        .category-title { font-weight: 600; color: #2c5b89; margin-bottom: 8px; display: flex; align-items: center; gap: 8px; }
        .device-checkbox { display: flex; align-items: center; margin-bottom: 8px; padding: 8px; border-radius: 4px; }
        .device-checkbox:hover { background: #fff; }
        .device-checkbox input[type="checkbox"] { margin-right: 12px; width: 18px; height: 18px; }
        .modal-actions { display: flex; justify-content: flex-end; gap: 12px; margin-top: 24px; }
        .alert { padding: 12px 16px; border-radius: 6px; margin-bottom: 16px; display: flex; align-items: center; gap: 8px; }
        .alert-success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .alert-error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .empty-state { text-align: center; padding: 60px 20px; color: #6c757d; }
        .empty-state i { font-size: 4rem; margin-bottom: 16px; opacity: 0.5; }
        .loading { display: flex; justify-content: center; align-items: center; padding: 40px; }
        .spinner { width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid #2c5b89; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @media (max-width: 768px) { .main-content { padding: 16px; } .page-header { flex-direction: column; gap: 16px; } .zones-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <header class="header"><div class="logo"><img src="https://via.placeholder.com/48x48?text=PS" alt="PRO-SAFE" class="logo-img">PRO-SAFE</div></header>
        <main class="main-content">
            <div class="page-header">
                <div><h1 class="page-title">Zone Management</h1><div id="selectedSiteInfo" style="display:none;margin-top:8px;"><div style="display:flex;align-items:center;gap:12px;color:#6c757d;font-size:0.9rem;"><i class="fas fa-building"></i><span id="siteNameDisplay"></span><span>â€¢</span><span id="siteIdDisplay"></span></div></div></div>
                <button class="btn btn-primary" onclick="openCreateZoneModal()"><i class="fas fa-plus"></i>Create New Zone</button>
            </div>
            <div id="alertContainer"></div>
            <div id="zonesGrid" class="zones-grid"></div>
            <div id="emptyState" class="empty-state" style="display:none;"><i class="fas fa-map-marked-alt"></i><h3>No Zones Created Yet</h3><p>Create your first zone to start organizing cameras and deterrent devices.</p><button class="btn btn-primary" onclick="openCreateZoneModal()"><i class="fas fa-plus"></i>Create First Zone</button></div>
            <div id="loadingState" class="loading" style="display:none;"><div class="spinner"></div></div>
        </main>
    </div>
    <div id="zoneModal" class="modal">
        <div class="modal-content">
            <div class="modal-header"><h2 id="modalTitle" class="modal-title">Create New Zone</h2><button class="close-btn" onclick="closeZoneModal()">&times;</button></div>
            <form id="zoneForm">
                <div class="form-group"><label for="zoneName" class="form-label">Zone Name</label><input type="text" id="zoneName" class="form-input" placeholder="e.g., Zone 1 - North Side" required></div>
                <div class="form-group"><label class="form-label">Assign Devices</label><div class="device-selection"><div class="device-category"><div class="category-title"><i class="fas fa-video"></i>Cameras</div><div id="cameraDevices"></div></div><div class="device-category"><div class="category-title"><i class="fas fa-shield-alt"></i>Deterrent Devices</div><div id="deterrentDevices"></div></div></div></div>
                <div class="modal-actions"><button type="button" class="btn btn-secondary" onclick="closeZoneModal()">Cancel</button><button type="submit" class="btn btn-primary"><i class="fas fa-save"></i>Save Zone</button></div>
            </form>
        </div>
    </div>
    <div id="deleteModal" class="modal">
        <div class="modal-content">
            <div class="modal-header"><h2 class="modal-title">Delete Zone</h2><button class="close-btn" onclick="closeDeleteModal()">&times;</button></div>
            <div style="margin-bottom:24px;"><p>Are you sure you want to delete the zone "<span id="deleteZoneName"></span>"?</p><p style="color:#dc3545;font-weight:600;margin-top:12px;"><i class="fas fa-exclamation-triangle"></i>This action cannot be undone.</p></div>
            <div class="modal-actions"><button class="btn btn-secondary" onclick="closeDeleteModal()">Cancel</button><button class="btn btn-danger" onclick="confirmDeleteZone()"><i class="fas fa-trash"></i>Delete Zone</button></div>
        </div>
    </div>
    <script>
        let zones = [];
        let devices = { cameras: [{id:'CAM001',name:'Camera 1 - Main Entrance',type:'Axis'},{id:'CAM002',name:'Camera 2 - Loading Dock',type:'Axis'},{id:'CAM003',name:'Camera 3 - Parking Lot',type:'Axis'},{id:'CAM004',name:'Camera 4 - Warehouse',type:'Axis'},{id:'CAM005',name:'Camera 5 - Security Gate',type:'Axis'}], deterrents: [{id:'DET001',name:'Alarm System 1',type:'Siren'},{id:'DET002',name:'Strobe Light 1',type:'Strobe'},{id:'DET003',name:'Alarm System 2',type:'Siren'},{id:'DET004',name:'Strobe Light 2',type:'Strobe'},{id:'DET005',name:'Alarm System 3',type:'Siren'}] };
        let currentZoneId = null, zoneToDelete = null;
        document.addEventListener('DOMContentLoaded', function() { loadZones(); setupEventListeners(); checkForSelectedSite(); });
        function setupEventListeners() { document.getElementById('zoneForm').addEventListener('submit', handleZoneSubmit); }
        function checkForSelectedSite() { const data = sessionStorage.getItem('selectedSite'); if (data) { const site = JSON.parse(data); document.getElementById('siteNameDisplay').textContent = site.name; document.getElementById('siteIdDisplay').textContent = `ID: ${site.id}`; document.getElementById('selectedSiteInfo').style.display = 'block'; document.querySelector('.page-title').textContent = `Zone Management - ${site.name}`; showAlert(`Site selected: ${site.name}`, 'success'); } }
        function loadZones() { const zonesGrid = document.getElementById('zonesGrid'), emptyState = document.getElementById('emptyState'), loadingState = document.getElementById('loadingState'); loadingState.style.display = 'flex'; zonesGrid.style.display = 'none'; emptyState.style.display = 'none'; setTimeout(() => { loadingState.style.display = 'none'; if (zones.length === 0) { emptyState.style.display = 'block'; } else { zonesGrid.style.display = 'grid'; renderZones(); } }, 500); }
        function renderZones() { const zonesGrid = document.getElementById('zonesGrid'); zonesGrid.innerHTML = ''; zones.forEach(zone => zonesGrid.appendChild(createZoneCard(zone))); }
        function createZoneCard(zone) { const card = document.createElement('div'); card.className = 'zone-card'; card.innerHTML = `<div class="zone-header"><div class="zone-title">${zone.name}</div><div class="zone-id">${zone.id}</div><div class="zone-actions"><button class="action-btn" onclick="editZone('${zone.id}')"><i class="fas fa-edit"></i></button><button class="action-btn" onclick="deleteZone('${zone.id}')"><i class="fas fa-trash"></i></button></div></div><div class="zone-content"><div class="device-section"><div class="section-title"><i class="fas fa-video"></i>Cameras (${zone.cameras.length})</div><div class="device-list">${zone.cameras.map(id => { const cam = devices.cameras.find(c => c.id === id); return cam ? `<span class="device-tag camera">${cam.name}</span>` : ''; }).join('')}</div></div><div class="device-section"><div class="section-title"><i class="fas fa-shield-alt"></i>Deterrents (${zone.deterrents.length})</div><div class="device-list">${zone.deterrents.map(id => { const det = devices.deterrents.find(d => d.id === id); return det ? `<span class="device-tag deterrent">${det.name}</span>` : ''; }).join('')}</div></div></div><div class="zone-stats"><div class="stat"><div class="stat-value">${zone.cameras.length}</div><div class="stat-label">Cameras</div></div><div class="stat"><div class="stat-value">${zone.deterrents.length}</div><div class="stat-label">Deterrents</div></div><div class="stat"><div class="stat-value">${new Date(zone.modifiedDate).toLocaleDateString()}</div><div class="stat-label">Modified</div></div></div>`; return card; }
        function openCreateZoneModal() { currentZoneId = null; document.getElementById('modalTitle').textContent = 'Create New Zone'; document.getElementById('zoneName').value = ''; populateDeviceCheckboxes(); document.getElementById('zoneModal').classList.add('show'); }
        function editZone(zoneId) { currentZoneId = zoneId; const zone = zones.find(z => z.id === zoneId); if (!zone) return; document.getElementById('modalTitle').textContent = 'Edit Zone'; document.getElementById('zoneName').value = zone.name; populateDeviceCheckboxes(zone); document.getElementById('zoneModal').classList.add('show'); }
        function populateDeviceCheckboxes(zone = null) { document.getElementById('cameraDevices').innerHTML = devices.cameras.map(cam => `<div class="device-checkbox"><input type="checkbox" id="cam_${cam.id}" value="${cam.id}" ${zone && zone.cameras.includes(cam.id) ? 'checked' : ''}><label for="cam_${cam.id}">${cam.name}</label></div>`).join(''); document.getElementById('deterrentDevices').innerHTML = devices.deterrents.map(det => `<div class="device-checkbox"><input type="checkbox" id="det_${det.id}" value="${det.id}" ${zone && zone.deterrents.includes(det.id) ? 'checked' : ''}><label for="det_${det.id}">${det.name}</label></div>`).join(''); }
        function handleZoneSubmit(event) { event.preventDefault(); const zoneName = document.getElementById('zoneName').value.trim(); if (!zoneName) { showAlert('Zone name is required', 'error'); return; } const selectedCameras = Array.from(document.querySelectorAll('#cameraDevices input:checked')).map(cb => cb.value); const selectedDeterrents = Array.from(document.querySelectorAll('#deterrentDevices input:checked')).map(cb => cb.value); if (selectedCameras.length === 0 && selectedDeterrents.length === 0) { showAlert('Please select at least one device', 'error'); return; } if (currentZoneId) { updateZone(currentZoneId, zoneName, selectedCameras, selectedDeterrents); } else { createZone(zoneName, selectedCameras, selectedDeterrents); } }
        function createZone(name, cameras, deterrents) { zones.push({ id: 'ZONE' + Date.now().toString().slice(-6), name, createdDate: new Date().toISOString(), modifiedDate: new Date().toISOString(), cameras, deterrents }); closeZoneModal(); loadZones(); showAlert('Zone created successfully!', 'success'); }
        function updateZone(zoneId, name, cameras, deterrents) { const idx = zones.findIndex(z => z.id === zoneId); if (idx === -1) return; zones[idx] = { ...zones[idx], name, cameras, deterrents, modifiedDate: new Date().toISOString() }; closeZoneModal(); loadZones(); showAlert('Zone updated successfully!', 'success'); }
        function deleteZone(zoneId) { const zone = zones.find(z => z.id === zoneId); if (!zone) return; zoneToDelete = zone; document.getElementById('deleteZoneName').textContent = zone.name; document.getElementById('deleteModal').classList.add('show'); }
        function confirmDeleteZone() { if (!zoneToDelete) return; zones = zones.filter(z => z.id !== zoneToDelete.id); closeDeleteModal(); loadZones(); showAlert('Zone deleted successfully!', 'success'); }
        function closeZoneModal() { document.getElementById('zoneModal').classList.remove('show'); document.getElementById('zoneForm').reset(); }
        function closeDeleteModal() { document.getElementById('deleteModal').classList.remove('show'); zoneToDelete = null; }
        function showAlert(message, type) { const container = document.getElementById('alertContainer'); const alert = document.createElement('div'); alert.className = `alert alert-${type}`; alert.innerHTML = `<i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i> ${message}`; container.appendChild(alert); setTimeout(() => alert.remove(), 5000); }
        window.onclick = function(e) { if (e.target.classList.contains('modal')) e.target.classList.remove('show'); }
    </script>
</body>
</html>
