<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zone Configuration - PRO-SAFE</title>
    <link href="https://fonts.googleapis.com/css?family=Inter:400,500,600,700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #2c5b89;
            --primary-dark: #1e4062;
            --primary-light: #3d6fa3;
            --secondary-color: #f0b178;
            --secondary-dark: #e09a3c;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
            --info-color: #17a2b8;
            --light-bg: #f8f9fa;
            --dark-bg: #181f26;
            --text-primary: #333;
            --text-secondary: #6c757d;
            --text-muted: #adb5bd;
            --border-color: #e9ecef;
            --shadow-sm: 0 2px 4px rgba(0,0,0,0.1);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.15);
            --shadow-lg: 0 8px 24px rgba(0,0,0,0.2);
            --border-radius: 8px;
            --border-radius-lg: 12px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: var(--text-primary);
            line-height: 1.6;
            font-weight: 400;
        }

        .dashboard-container {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            color: #fff;
            display: flex;
            align-items: center;
            padding: 0 32px;
            height: 72px;
            font-size: 1.2rem;
            font-weight: 600;
            box-shadow: var(--shadow-md);
            position: relative;
            z-index: 100;
        }

        .logo {
            display: flex;
            align-items: center;
            font-size: 2rem;
            font-weight: bold;
            margin-right: 16px;
        }

        .logo-img {
            width: 48px;
            height: 48px;
            margin-right: 12px;
            vertical-align: middle;
            background: #2c5b89;
            border-radius: 50%;
            padding: 4px;
            box-sizing: content-box;
            display: inline-block;
        }

        .header .version {
            margin-left: auto;
            font-size: 1rem;
            opacity: 0.8;
            display: flex;
            align-items: center;
        }

        .admin-portal {
            margin-left: 24px;
            font-size: 1.1rem;
            font-weight: 500;
            cursor: pointer;
            padding: 8px 16px;
            border-radius: 4px;
            transition: background 0.2s;
        }

        .admin-portal:hover {
            background: #1e4062;
        }

        .main-content {
            flex: 1;
            padding: 32px;
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            gap: 16px;
        }

        .page-title {
            font-size: 2rem;
            font-weight: 700;
            color: #2c5b89;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: var(--border-radius);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 8px;
            position: relative;
            overflow: hidden;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: #fff;
            box-shadow: var(--shadow-sm);
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary-color));
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6c757d, #545b62);
            color: #fff;
            box-shadow: var(--shadow-sm);
        }

        .btn-secondary:hover {
            background: linear-gradient(135deg, #545b62, #6c757d);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success-color), #218838);
            color: #fff;
            box-shadow: var(--shadow-sm);
        }

        .btn-success:hover {
            background: linear-gradient(135deg, #218838, var(--success-color));
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .section-card {
            background: #fff;
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-md);
            padding: 24px;
            margin-bottom: 24px;
            border: 1px solid var(--border-color);
        }

        .section-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #2c5b89;
            margin-bottom: 16px;
        }

        .search-box {
            position: relative;
            flex: 1;
            max-width: 420px;
        }

        .search-input {
            width: 100%;
            padding: 12px 16px 12px 48px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            font-size: 1rem;
        }

        .search-input:focus {
            outline: none;
            border-color: #2c5b89;
        }

        .search-icon {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: #6c757d;
        }

        .table-container {
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
            overflow: hidden;
            border: 1px solid var(--border-color);
        }

        .table-header {
            background: #2c5b89;
            color: #fff;
            padding: 16px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table-title {
            font-size: 1.1rem;
            font-weight: 700;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th {
            background: #1f5d7d;
            color: #fff;
            font-weight: 600;
            text-align: left;
            padding: 14px 18px;
            border-bottom: 2px solid #1a4f6b;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.4px;
        }

        .table td {
            padding: 14px 18px;
            border-bottom: 1px solid #e9ecef;
            vertical-align: middle;
        }

        .table tbody tr:hover {
            background: #f8f9fa;
        }

        .row-selected {
            background: #e3f2fd;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            background: #dc3545;
            box-shadow: 0 0 0 2px #fff;
        }

        .status-dot.configured {
            background: #28a745;
        }

        .potential-id {
            font-weight: 600;
            color: #2c5b89;
            font-family: 'Courier New', monospace;
        }

        .industry {
            background: #e9ecef;
            color: #495057;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .timezone {
            background: #d1ecf1;
            color: #0c5460;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
            text-align: center;
            min-width: 40px;
            display: inline-block;
        }

        .zone-status {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .zone-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .zone-badge.configured {
            background: #d4edda;
            color: #155724;
        }

        .zone-badge.not-configured {
            background: #f8d7da;
            color: #721c24;
        }

        .action-btn {
            background: #2c5b89;
            color: #fff;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s, transform 0.2s;
            box-shadow: 0 4px 10px rgba(0,0,0,0.15);
        }

        .action-btn:hover {
            background: #1e4062;
            transform: translateY(-1px);
        }

        .pagination {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
            background: #f8f9fa;
            border-top: 1px solid #e9ecef;
        }

        .pagination-arrow {
            background: #fff;
            border: 1px solid #ced4da;
            color: #6c757d;
            width: 32px;
            height: 32px;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .pagination-arrow:hover:not(:disabled) {
            background: #2c5b89;
            color: #fff;
            border-color: #2c5b89;
        }

        .pagination-arrow:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .alert {
            padding: 12px 16px;
            border-radius: 6px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #6c757d;
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 12px;
            opacity: 0.5;
        }

        .empty-state h3 {
            font-size: 1.3rem;
            margin-bottom: 8px;
            color: #495057;
        }

        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 40px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #2c5b89;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .map-layout {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 24px;
            margin-top: 16px;
        }

        .site-map-container {
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.1);
            overflow: hidden;
            border: 1px solid var(--border-color);
        }

        .map-header {
            background: #2c5b89;
            color: #fff;
            padding: 16px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .map-title {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .map-controls {
            display: flex;
            gap: 8px;
        }

        .map-control-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: #fff;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background 0.2s;
        }

        .map-control-btn:hover,
        .map-control-btn.active {
            background: rgba(255,255,255,0.4);
        }

        .site-map {
            position: relative;
            width: 100%;
            height: 460px;
            background: linear-gradient(45deg, #f0f0f0 25%, transparent 25%),
                        linear-gradient(-45deg, #f0f0f0 25%, transparent 25%),
                        linear-gradient(45deg, transparent 75%, #f0f0f0 75%),
                        linear-gradient(-45deg, transparent 75%, #f0f0f0 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
            overflow: hidden;
        }

        .map-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .zone-overlay {
            position: absolute;
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: rgba(44, 91, 137, 0.1);
            border: 2px solid rgba(44, 91, 137, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: #2c5b89;
            font-size: 1.1rem;
            pointer-events: auto;
            cursor: pointer;
            transition: all 0.2s;
        }

        .zone-overlay:hover {
            background: rgba(44, 91, 137, 0.2);
            border-color: rgba(44, 91, 137, 0.5);
            transform: scale(1.05);
        }

        .zone-overlay.active {
            background: rgba(220, 53, 69, 0.2);
            border-color: rgba(220, 53, 69, 0.5);
            color: #dc3545;
        }

        .device-marker {
            position: absolute;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            z-index: 10;
        }

        .device-marker.camera {
            background: #1976d2;
            color: #fff;
            border: 2px solid #fff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .device-marker.deterrent {
            background: #f57c00;
            color: #fff;
            border: 2px solid #fff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .device-marker:hover {
            transform: scale(1.2);
            z-index: 20;
        }

        .device-tooltip {
            position: absolute;
            background: #333;
            color: #fff;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.8rem;
            white-space: nowrap;
            z-index: 30;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .device-tooltip.show {
            opacity: 1;
        }

        .map-legend {
            position: absolute;
            bottom: 16px;
            right: 16px;
            background: rgba(255,255,255,0.95);
            padding: 12px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            font-size: 0.8rem;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 4px;
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .legend-color.camera {
            background: #1976d2;
        }

        .legend-color.deterrent {
            background: #f57c00;
        }

        .legend-color.zone {
            background: rgba(44, 91, 137, 0.3);
            border: 1px solid rgba(44, 91, 137, 0.5);
        }

        .map-info {
            position: absolute;
            top: 16px;
            left: 16px;
            background: rgba(255,255,255,0.95);
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.8rem;
            color: #666;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .map-sidebar {
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.1);
            padding: 20px;
            border: 1px solid var(--border-color);
        }

        .sidebar-section {
            margin-bottom: 24px;
        }

        .sidebar-title {
            font-size: 1rem;
            font-weight: 600;
            color: #2c5b89;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .device-list-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.2s;
            margin-bottom: 4px;
        }

        .device-list-item:hover {
            background: #f8f9fa;
        }

        .device-list-item.selected {
            background: #e3f2fd;
            border-left: 3px solid #1976d2;
        }

        .device-icon {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: 600;
        }

        .device-icon.camera {
            background: #1976d2;
            color: #fff;
        }

        .device-icon.deterrent {
            background: #f57c00;
            color: #fff;
        }

        .zones-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .zone-card {
            background: #fff;
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-md);
            overflow: hidden;
            transition: var(--transition);
            border: 1px solid var(--border-color);
            position: relative;
        }

        .zone-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
        }

        .zone-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary-color);
        }

        .zone-header {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: #fff;
            padding: 20px;
            position: relative;
        }

        .zone-title {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 6px;
        }

        .zone-id {
            font-size: 0.85rem;
            opacity: 0.8;
            font-family: 'Courier New', monospace;
        }

        .zone-actions {
            position: absolute;
            top: 16px;
            right: 16px;
            display: flex;
            gap: 8px;
        }

        .zone-action-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: #fff;
            width: 32px;
            height: 32px;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
        }

        .zone-action-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        .zone-content {
            padding: 18px;
        }

        .device-section {
            margin-bottom: 16px;
        }

        .device-section-title {
            font-size: 1rem;
            font-weight: 600;
            color: #2c5b89;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .device-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .device-tag {
            background: var(--light-bg);
            color: var(--text-secondary);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 6px;
            border: 1px solid var(--border-color);
        }

        .device-tag.camera {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            color: #1976d2;
            border-color: #90caf9;
        }

        .device-tag.deterrent {
            background: linear-gradient(135deg, #fff3e0, #ffe0b2);
            color: #f57c00;
            border-color: #ffcc02;
        }

        .zone-stats {
            display: flex;
            justify-content: space-between;
            padding: 14px 18px;
            background: #f8f9fa;
            border-top: 1px solid #e9ecef;
        }

        .stat {
            text-align: center;
        }

        .stat-value {
            font-size: 1.2rem;
            font-weight: 700;
            color: #2c5b89;
        }

        .stat-label {
            font-size: 0.75rem;
            color: #6c757d;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: #fff;
            border-radius: var(--border-radius-lg);
            padding: 30px;
            max-width: 700px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border-color);
            position: relative;
        }

        .modal-content.modal-xl {
            max-width: 1250px;
            width: 1250px;
            max-height: 700px;
            height: 700px;
        }

        .modal-header-actions {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .modal-toolbar {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-left: auto;
            margin-right: 12px;
        }

        .toolbar-btn {
            border: none;
            background: #1e88e5;
            color: #fff;
            padding: 6px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85rem;
        }

        .toolbar-btn:hover {
            background: #1565c0;
        }

        .zone-management-body {
            min-height: 300px;
        }

        .zone-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 16px;
        }

        .zone-list-item {
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 16px;
            background: #fff;
            box-shadow: var(--shadow-sm);
        }

        .zone-list-title {
            font-weight: 700;
            color: #2c5b89;
            margin-bottom: 6px;
        }

        .zone-list-meta {
            color: #6c757d;
            font-size: 0.85rem;
            margin-bottom: 12px;
        }

        .zone-list-actions {
            display: flex;
            gap: 8px;
        }

        .site-result-item {
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 16px;
            background: #fff;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 12px;
        }

        .site-result-title {
            font-weight: 700;
            color: #2c5b89;
            margin-bottom: 4px;
        }

        .site-result-meta {
            color: #6c757d;
            font-size: 0.9rem;
        }

        .zone-create-layout {
            display: grid;
            grid-template-columns: 1.2fr 1fr;
            gap: 20px;
        }

        .zone-map-pane {
            border: 1px solid var(--border-color);
            border-radius: 8px;
            overflow: hidden;
            background: #f5f7fa;
            min-height: 420px;
        }

        .zone-map-pane img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        .zone-form-pane {
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 16px;
            background: #fff;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: -28px -28px 20px -28px;
            padding: 16px 24px;
            background: #1f5d7d;
            color: #fff;
            border-radius: var(--border-radius-lg) var(--border-radius-lg) 0 0;
        }

        .modal-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: #fff;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #fff;
        }

        .form-group {
            margin-bottom: 18px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #495057;
        }

        .form-input {
            width: 100%;
            padding: 14px;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: 1rem;
            background: #fff;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(44, 91, 137, 0.1);
        }

        .device-selection {
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            padding: 16px;
            max-height: 250px;
            overflow-y: auto;
            background: var(--light-bg);
        }

        .monitoring-card {
            border: 1px solid var(--border-color);
            border-radius: 8px;
            overflow: hidden;
            background: #fff;
        }

        .monitoring-header {
            background: #1f5d7d;
            color: #fff;
            padding: 10px 14px;
            font-weight: 700;
        }

        .monitoring-body {
            padding: 14px;
        }

        .monitoring-status {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            margin-bottom: 12px;
        }

        .monitoring-status-text {
            color: #333;
            font-size: 0.95rem;
        }

        .monitoring-actions {
            display: flex;
            gap: 8px;
        }

        .btn-arm {
            background: #3b5bd6;
            color: #fff;
        }

        .btn-disarm {
            background: #d9d9d9;
            color: #6c757d;
        }

        .monitoring-hours-title {
            font-weight: 700;
            margin: 10px 0 8px;
            color: #2c5b89;
        }

        .hours-grid {
            display: grid;
            grid-template-columns: 120px 1fr 1fr;
            gap: 8px 10px;
            align-items: center;
        }

        .hours-grid label {
            font-size: 0.9rem;
            color: #333;
        }

        .time-input,
        .time-select {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid #ced4da;
            border-radius: 6px;
            font-size: 0.9rem;
        }

        .device-category {
            margin-bottom: 16px;
        }

        .category-title {
            font-weight: 600;
            color: #2c5b89;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .device-checkbox {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            padding: 8px;
            border-radius: 4px;
            transition: background 0.2s;
        }

        .device-checkbox:hover {
            background: #f8f9fa;
        }

        .device-checkbox input[type="checkbox"] {
            margin-right: 12px;
            width: 18px;
            height: 18px;
        }

        .form-error {
            color: #dc3545;
            font-size: 0.875rem;
            margin-top: 4px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .form-input.error {
            border-color: #dc3545;
        }

        .device-selection.error {
            border-color: #dc3545;
        }

        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            margin-top: 20px;
        }

        @media (max-width: 1200px) {
            .map-layout {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .main-content {
                padding: 16px;
            }

            .page-header {
                flex-direction: column;
                align-items: stretch;
            }

            .header-actions {
                flex-direction: column;
                align-items: stretch;
            }

            .zones-grid {
                grid-template-columns: 1fr;
            }

            .zone-create-layout {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <header class="header">
            <div class="logo">
                <img src="logo.png" alt="PRO-SAFE" class="logo-img">
                PRO-SAFE
            </div>
            <span class="admin-portal">Admin Portal</span>
        </header>

        <main class="main-content">
            <div class="page-header">
                <div>
                    <h1 class="page-title">Site Zone Configuration</h1>
                </div>
                <div class="header-actions">
                    <div class="search-box" style="max-width: 360px;">
                        <i class="fas fa-search search-icon"></i>
                        <input type="text" id="siteConfigSearch" class="search-input" placeholder="Site Search">
                    </div>
                </div>
            </div>

            <div id="alertContainer"></div>

            <section class="section-card" id="siteConfigSection">
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Potential ID</th>
                                <th>Site Name</th>
                                <th>Industry</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="siteConfigTableBody"></tbody>
                    </table>
                    <div class="pagination">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <label>Items per page:</label>
                            <select id="configItemsPerPage" style="padding: 4px 8px; border: 1px solid #ced4da; border-radius: 4px;" onchange="updateConfigItemsPerPage()">
                                <option value="10" selected>10</option>
                                <option value="20">20</option>
                                <option value="50">50</option>
                            </select>
                        </div>
                        <div style="display: flex; align-items: center; gap: 16px;">
                            <span id="configPaginationText" style="color: #6c757d; font-size: 0.9rem;">1 - 8 of 0</span>
                            <div style="display: flex; gap: 8px;">
                                <button class="pagination-arrow" id="configPrevPage" onclick="previousConfigPage()" disabled><i class="fas fa-chevron-left"></i></button>
                                <button class="pagination-arrow" id="configNextPage" onclick="nextConfigPage()"><i class="fas fa-chevron-right"></i></button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>
    <div id="zoneManagementModal" class="modal">
        <div class="modal-content modal-xl">
            <div class="modal-header">
                <h2 id="zoneManagementTitle" class="modal-title">Zone Management</h2>
                <div class="modal-header-actions">
                    <button class="btn btn-primary" onclick="openCreateZoneModal()">
                        <i class="fas fa-plus"></i>
                        Create New Zone
                    </button>
                    <button class="close-btn" onclick="closeZoneManagementModal()">&times;</button>
                </div>
            </div>
            <div class="zone-management-body">
                <div id="zoneList" class="zone-list"></div>
                <div id="zoneEmptyState" class="empty-state" style="display: none;">
                    <i class="fas fa-map-marked-alt"></i>
                    <h3>No Zones Created Yet</h3>
                    <p>Create your first zone for this site.</p>
                </div>
            </div>
        </div>
    </div>

    <div id="nonConfiguredModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title"></h2>
                <button class="close-btn" onclick="closeNonConfiguredModal()">&times;</button>
            </div>
            <div id="nonConfiguredResults"></div>
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" onclick="closeNonConfiguredModal()">Close</button>
            </div>
        </div>
    </div>

    <div id="zoneModal" class="modal">
        <div class="modal-content modal-xl">
            <div class="modal-header">
                <h2 id="modalTitle" class="modal-title">Create New Zone</h2>
                <div class="modal-toolbar">
                    <button class="toolbar-btn" title="Zoom In"><i class="fas fa-plus"></i></button>
                    <button class="toolbar-btn" title="Zoom Out"><i class="fas fa-minus"></i></button>
                    <button class="toolbar-btn" title="Reset">Reset</button>
                </div>
                <button class="close-btn" onclick="closeZoneModal()">&times;</button>
            </div>

            <div id="modalAlertContainer"></div>

            <div class="zone-create-layout">
                <div class="zone-map-pane">
                    <img src="C:\Users\abdulkalam.mohammed_\Documents\prosafe-html-files\Screenshot 2026-01-20 201031.png" alt="Site map preview">
                </div>
                <div class="zone-form-pane">
                    <form id="zoneForm">
                        <div class="form-group">
                            <label for="zoneName" class="form-label">Zone Name <span style="color:#dc3545">*</span></label>
                            <input type="text" id="zoneName" class="form-input" placeholder="e.g., Zone 1 - North Side" required>
                            <div id="zoneNameError" class="form-error" style="display: none;"></div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Assign Devices</label>
                            <div class="device-selection">
                                <div class="device-category">
                                    <div class="category-title">
                                        <i class="fas fa-video"></i>
                                        Cameras
                                    </div>
                                    <div id="cameraDevices"></div>
                                </div>

                                <div class="device-category">
                                    <div class="category-title">
                                        <i class="fas fa-shield-alt"></i>
                                        Deterrent Devices
                                    </div>
                                    <div id="deterrentDevices"></div>
                                </div>
                            </div>
                            <div id="deviceSelectionError" class="form-error" style="display: none;"></div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Configure Zone Based Monitoring Hours</label>
                            <div class="monitoring-card">
                                <div class="monitoring-header">Monitoring Details</div>
                                <div class="monitoring-body">
                                    <div class="monitoring-status">
                                        <div class="monitoring-status-text">
                                            This site is currently <strong>DISARMED</strong> and <strong>OUTSIDE</strong> monitoring hours
                                        </div>
                                        <div class="monitoring-actions">
                                            <button type="button" class="btn btn-arm">Arm</button>
                                            <button type="button" class="btn btn-disarm">Disarm</button>
                                        </div>
                                    </div>

                                    <div class="monitoring-hours-title">Monitoring Hours</div>
                                    <div class="hours-grid">
                                        <label>Monday</label>
                                        <select class="time-select" data-value="12:00 AM"></select>
                                        <select class="time-select" data-value="07:00 AM"></select>

                                        <label>Tuesday</label>
                                        <select class="time-select" data-value="12:00 AM"></select>
                                        <select class="time-select" data-value="07:00 AM"></select>

                                        <label>Wednesday</label>
                                        <select class="time-select" data-value="12:00 AM"></select>
                                        <select class="time-select" data-value="07:00 AM"></select>

                                        <label>Thursday</label>
                                        <select class="time-select" data-value="12:00 AM"></select>
                                        <select class="time-select" data-value="07:00 AM"></select>

                                        <label>Friday</label>
                                        <select class="time-select" data-value="12:00 AM"></select>
                                        <select class="time-select" data-value="07:00 AM"></select>

                                        <label>Saturday</label>
                                        <select class="time-select" data-value="12:00 AM"></select>
                                        <select class="time-select" data-value="07:00 AM"></select>

                                        <label>Sunday</label>
                                        <select class="time-select" data-value="12:00 AM"></select>
                                        <select class="time-select" data-value="07:00 AM"></select>
                                    </div>

                                    <div class="monitoring-hours-title">Additional Monitoring Hours</div>
                                    <div class="hours-grid">
                                        <label>All Days</label>
                                        <select class="time-select" data-value="07:00 PM"></select>
                                        <select class="time-select" data-value="11:59 PM"></select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" onclick="closeZoneModal()">Cancel</button>
                <button type="submit" class="btn btn-primary" form="zoneForm">
                    <i class="fas fa-save"></i>
                    Save Zone
                </button>
            </div>
        </div>
    </div>

    <div id="deleteModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Delete Zone</h2>
                <button class="close-btn" onclick="closeDeleteModal()">&times;</button>
            </div>

            <div style="margin-bottom: 24px;">
                <p>Are you sure you want to delete the zone "<span id="deleteZoneName"></span>"?</p>
                <p style="color: #dc3545; font-weight: 600; margin-top: 12px;">
                    <i class="fas fa-exclamation-triangle"></i>
                    This action cannot be undone. All devices will become unassigned.
                </p>
            </div>

            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeDeleteModal()">Cancel</button>
                <button class="btn btn-secondary" style="background: linear-gradient(135deg, var(--danger-color), #c82333);" onclick="confirmDeleteZone()">
                    <i class="fas fa-trash"></i>
                    Delete Zone
                </button>
            </div>
        </div>
    </div>

    <script>
        const sites = [
            { id: 270258, name: "Martin Marietta - Tanner 2012 F7-3", industry: "Commercial Property", timezone: "CT", zoneStatus: "configured" },
            { id: 464927, name: "R & R Consultants - 1875 Marin Street F38", industry: "Consulting", timezone: "PT", zoneStatus: "not-configured" },
            { id: 532403, name: "Martin Marietta - Genoa Red Bluff F7-4", industry: "Construction Commercial", timezone: "CT", zoneStatus: "configured" },
            { id: 535269, name: "Martin Marietta - Cherry Yard F7-6", industry: "Construction Commercial", timezone: "CT", zoneStatus: "not-configured" },
            { id: 577938, name: "Port San Antonio - CAM Zone Monitoring MD859", industry: "Commercial Property", timezone: "CT", zoneStatus: "configured" },
            { id: 577943, name: "Port San Antonio - CAM Zone Monitoring MDX051", industry: "Commercial Property", timezone: "CT", zoneStatus: "configured" },
            { id: 577946, name: "Port San Antonio - CAM Zone Monitoring MDX013", industry: "Commercial Property", timezone: "CT", zoneStatus: "configured" },
            { id: 577951, name: "Port San Antonio - CAM Zone Monitoring MDX056", industry: "Commercial Property", timezone: "CT", zoneStatus: "configured" },
            { id: 612847, name: "Century Communities - MDX3330", industry: "Residential Construction", timezone: "MT", zoneStatus: "configured" },
            { id: 723456, name: "Newco Metals - F3097AO", industry: "Manufacturing", timezone: "ET", zoneStatus: "configured" },
            { id: 834567, name: "TechCorp Solutions - Silicon Valley Campus", industry: "Technology", timezone: "PT", zoneStatus: "configured" },
            { id: 945678, name: "Green Energy Solar Farm - Desert Site", industry: "Renewable Energy", timezone: "MT", zoneStatus: "not-configured" },
            { id: 1056789, name: "Metro Hospital - Downtown Campus", industry: "Healthcare", timezone: "CT", zoneStatus: "configured" },
            { id: 1167890, name: "University Research Lab - Science Building", industry: "Education", timezone: "ET", zoneStatus: "configured" },
            { id: 1278901, name: "Port Authority - Container Terminal", industry: "Logistics", timezone: "PT", zoneStatus: "not-configured" },
            { id: 1389012, name: "Downtown Financial Center - Tower A", industry: "Financial Services", timezone: "ET", zoneStatus: "configured" },
            { id: 1490123, name: "Airport Cargo Facility - Terminal 3", industry: "Aviation", timezone: "CT", zoneStatus: "configured" },
            { id: 1501234, name: "Shopping Mall - Westside Plaza", industry: "Retail", timezone: "PT", zoneStatus: "not-configured" },
            { id: 1612345, name: "Government Building - City Hall Annex", industry: "Government", timezone: "ET", zoneStatus: "configured" },
            { id: 1723456, name: "Warehouse Complex - Industrial Park", industry: "Warehousing", timezone: "MT", zoneStatus: "configured" },
            { id: 1830045, name: "Westland Industrial Park - Zone A", industry: "Warehousing", timezone: "CT", zoneStatus: "configured" },
            { id: 1932101, name: "Westland Site 1", industry: "Warehousing", timezone: "CT", zoneStatus: "not-configured" },
            { id: 1932102, name: "Westland Site 2", industry: "Warehousing", timezone: "CT", zoneStatus: "not-configured" }
        ];

        const siteZones = {
            270258: [
                { id: "ZONE001", name: "North Entrance Zone", createdDate: "2024-01-15T10:30:00Z", modifiedDate: "2024-01-20T14:45:00Z", cameras: ["CAM001", "CAM002"], deterrents: ["DET001", "DET002"] },
                { id: "ZONE002", name: "Loading Dock Zone", createdDate: "2024-01-16T09:15:00Z", modifiedDate: "2024-01-18T16:20:00Z", cameras: ["CAM003", "CAM004"], deterrents: ["DET003", "DET004"] }
            ],
            464927: [
                { id: "ZONE001", name: "Main Office Zone", createdDate: "2024-02-10T08:30:00Z", modifiedDate: "2024-02-15T11:20:00Z", cameras: ["CAM001", "CAM005"], deterrents: ["DET001"] }
            ],
            532403: [
                { id: "ZONE001", name: "Production Floor Zone", createdDate: "2024-01-20T14:00:00Z", modifiedDate: "2024-01-25T09:30:00Z", cameras: ["CAM001", "CAM002", "CAM003"], deterrents: ["DET001", "DET002", "DET003"] },
                { id: "ZONE002", name: "Storage Area Zone", createdDate: "2024-01-22T16:45:00Z", modifiedDate: "2024-01-28T13:15:00Z", cameras: ["CAM004", "CAM005"], deterrents: ["DET004", "DET005"] }
            ],
            535269: [
                { id: "ZONE001", name: "Yard Operations Zone", createdDate: "2024-01-25T07:30:00Z", modifiedDate: "2024-01-30T15:45:00Z", cameras: ["CAM001", "CAM002"], deterrents: ["DET001", "DET002"] }
            ],
            577938: [
                { id: "ZONE001", name: "Security Checkpoint Zone", createdDate: "2024-02-01T06:00:00Z", modifiedDate: "2024-02-05T12:30:00Z", cameras: ["CAM001", "CAM002", "CAM003"], deterrents: ["DET001", "DET002"] },
                { id: "ZONE002", name: "Perimeter Zone", createdDate: "2024-02-03T08:15:00Z", modifiedDate: "2024-02-08T14:20:00Z", cameras: ["CAM004", "CAM005"], deterrents: ["DET003", "DET004", "DET005"] },
                { id: "ZONE003", name: "Warehouse Zone", createdDate: "2024-02-05T10:30:00Z", modifiedDate: "2024-02-10T16:45:00Z", cameras: ["CAM001", "CAM003"], deterrents: ["DET001", "DET003"] }
            ],
            577943: [
                { id: "ZONE001", name: "Main Gate Zone", createdDate: "2024-02-12T09:00:00Z", modifiedDate: "2024-02-15T11:30:00Z", cameras: ["CAM001", "CAM002"], deterrents: ["DET001", "DET002"] }
            ],
            577946: [
                { id: "ZONE001", name: "East Wing Zone", createdDate: "2024-02-14T07:30:00Z", modifiedDate: "2024-02-18T13:45:00Z", cameras: ["CAM001", "CAM003", "CAM004"], deterrents: ["DET001", "DET003"] }
            ],
            577951: [
                { id: "ZONE001", name: "West Wing Zone", createdDate: "2024-02-16T08:45:00Z", modifiedDate: "2024-02-20T15:20:00Z", cameras: ["CAM002", "CAM005"], deterrents: ["DET002", "DET004"] }
            ],
            612847: [
                { id: "ZONE001", name: "Zone 1 - Main Gate", createdDate: "2024-02-18T08:30:00Z", modifiedDate: "2024-02-20T10:15:00Z", cameras: ["CAM001", "CAM002", "CAM003"], deterrents: ["DET001", "DET002"] },
                { id: "ZONE002", name: "Zone 2 - Construction Area", createdDate: "2024-02-19T09:45:00Z", modifiedDate: "2024-02-21T12:30:00Z", cameras: ["CAM004", "CAM005"], deterrents: ["DET003"] }
            ],
            1830045: [
                { id: "ZONE001", name: "Main Yard Zone", createdDate: "2024-03-05T09:00:00Z", modifiedDate: "2024-03-10T15:45:00Z", cameras: ["CAM001", "CAM002"], deterrents: ["DET001"] }
            ]
        };

        const devices = {
            cameras: [
                { id: "CAM001", name: "Camera 1 - Main Entrance", type: "Axis" },
                { id: "CAM002", name: "Camera 2 - Loading Dock", type: "Axis" },
                { id: "CAM003", name: "Camera 3 - Parking Lot", type: "Axis" },
                { id: "CAM004", name: "Camera 4 - Warehouse Interior", type: "Axis" },
                { id: "CAM005", name: "Camera 5 - Security Gate", type: "Axis" }
            ],
            deterrents: [
                { id: "DET001", name: "Alarm System 1", type: "Siren" },
                { id: "DET002", name: "Strobe Light 1", type: "Strobe" },
                { id: "DET003", name: "Alarm System 2", type: "Siren" },
                { id: "DET004", name: "Strobe Light 2", type: "Strobe" },
                { id: "DET005", name: "Alarm System 3", type: "Siren" }
            ]
        };

        let currentSite = null;
        let zones = [];
        let currentZoneId = null;
        let zoneToDelete = null;

        let configCurrentPage = 1;
        let configItemsPerPage = 10;
        let configFilteredSites = [];
        let siteSearchTimer = null;

        document.addEventListener("DOMContentLoaded", function() {
            resetConfigFilter();
            renderSiteConfigTable();

            document.getElementById("siteConfigSearch").addEventListener("input", function() {
                if (siteSearchTimer) {
                    clearTimeout(siteSearchTimer);
                }
                siteSearchTimer = setTimeout(handleSiteSearchInput, 150);
            });
            document.getElementById("zoneForm").addEventListener("submit", handleZoneSubmit);
            populateTimeSelects();
        });

        function populateTimeSelects() {
            const selects = document.querySelectorAll(".time-select");
            const options = buildTimeOptions();

            selects.forEach(select => {
                select.innerHTML = options;
                const defaultValue = select.getAttribute("data-value");
                if (defaultValue) {
                    select.value = defaultValue;
                }
            });
        }

        function buildTimeOptions() {
            const options = [];
            for (let hour = 0; hour < 24; hour++) {
                for (let minute of [0, 30]) {
                    const label = formatTimeLabel(hour, minute);
                    options.push(`<option value="${label}">${label}</option>`);
                }
            }
            options.push(`<option value="11:59 PM">11:59 PM</option>`);
            return options.join("");
        }

        function formatTimeLabel(hour, minute) {
            const period = hour >= 12 ? "PM" : "AM";
            const displayHour = hour % 12 === 0 ? 12 : hour % 12;
            const displayMinute = minute.toString().padStart(2, "0");
            return `${displayHour}:${displayMinute} ${period}`;
        }

        function getConfiguredSites() {
            return sites.filter(site => site.zoneStatus === "configured");
        }

        function resetConfigFilter() {
            configFilteredSites = getConfiguredSites();
            configCurrentPage = 1;
        }

        function refreshConfigList() {
            const searchTerm = document.getElementById("siteConfigSearch").value.trim().toLowerCase();
            if (!searchTerm) {
                resetConfigFilter();
            } else {
                configFilteredSites = getConfiguredSites().filter(site =>
                    site.name.toLowerCase().includes(searchTerm) ||
                    site.id.toString().includes(searchTerm)
                );
            }
            renderSiteConfigTable();
        }

        function renderSiteConfigTable() {
            const tableBody = document.getElementById("siteConfigTableBody");
            const startIndex = (configCurrentPage - 1) * configItemsPerPage;
            const endIndex = startIndex + configItemsPerPage;
            const pageSites = configFilteredSites.slice(startIndex, endIndex);

            tableBody.innerHTML = "";
            pageSites.forEach(site => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td class="potential-id">${site.id}</td>
                    <td>${site.name}</td>
                    <td><span class="industry">${site.industry}</span></td>
                    <td><span class="status-dot ${site.zoneStatus}"></span></td>
                    <td>
                        <button class="action-btn" onclick="openZoneManagementModal(${site.id})" title="Configure Zones">
                            <i class="fas fa-cog"></i>
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
            });

            updateConfigPagination();
        }

        function updateConfigPagination() {
            const totalItems = configFilteredSites.length;
            const startItem = totalItems === 0 ? 0 : (configCurrentPage - 1) * configItemsPerPage + 1;
            const endItem = Math.min(configCurrentPage * configItemsPerPage, totalItems);

            document.getElementById("configPaginationText").textContent = `${startItem} - ${endItem} of ${totalItems}`;
            document.getElementById("configPrevPage").disabled = configCurrentPage === 1;
            document.getElementById("configNextPage").disabled = endItem >= totalItems;
        }

        function updateConfigItemsPerPage() {
            configItemsPerPage = parseInt(document.getElementById("configItemsPerPage").value, 10);
            configCurrentPage = 1;
            renderSiteConfigTable();
        }

        function previousConfigPage() {
            if (configCurrentPage > 1) {
                configCurrentPage--;
                renderSiteConfigTable();
            }
        }

        function nextConfigPage() {
            const totalPages = Math.ceil(configFilteredSites.length / configItemsPerPage);
            if (configCurrentPage < totalPages) {
                configCurrentPage++;
                renderSiteConfigTable();
            }
        }

        function filterSiteConfigTable() {
            const searchTerm = document.getElementById("siteConfigSearch").value.trim().toLowerCase();
            if (!searchTerm) {
                configFilteredSites = getConfiguredSites();
            } else {
                configFilteredSites = getConfiguredSites().filter(site =>
                    site.name.toLowerCase().includes(searchTerm) ||
                    site.id.toString().includes(searchTerm)
                );
            }
            configCurrentPage = 1;
            renderSiteConfigTable();
        }

        function handleSiteSearchInput() {
            const searchTerm = document.getElementById("siteConfigSearch").value.trim().toLowerCase();
            filterSiteConfigTable();

            if (!searchTerm) {
                closeNonConfiguredModal();
                return;
            }

            if (configFilteredSites.length > 0) {
                closeNonConfiguredModal();
                return;
            }

            const nonConfiguredMatches = sites.filter(site =>
                site.zoneStatus !== "configured" &&
                (site.name.toLowerCase().includes(searchTerm) || site.id.toString().includes(searchTerm))
            );

            if (nonConfiguredMatches.length > 0) {
                showNonConfiguredModal(nonConfiguredMatches);
            } else {
                closeNonConfiguredModal();
            }
        }

        function showNonConfiguredModal(results) {
            const modal = document.getElementById("nonConfiguredModal");
            const container = document.getElementById("nonConfiguredResults");
            container.innerHTML = results.map(site => `
                <div class="site-result-item">
                    <div>
                        <div class="site-result-title">${site.name}</div>
                        <div class="site-result-meta">${site.id}  ${site.industry}</div>
                    </div>
                    <button class="btn btn-primary" onclick="createZoneForSite(${site.id})">
                        <i class="fas fa-plus"></i>
                        Create New Zone
                    </button>
                </div>
            `).join("");
            modal.classList.add("show");
        }

        function closeNonConfiguredModal() {
            const modal = document.getElementById("nonConfiguredModal");
            if (modal) {
                modal.classList.remove("show");
            }
        }

        function createZoneForSite(siteId) {
            closeNonConfiguredModal();
            openZoneManagementModal(siteId);
            openCreateZoneModal();
        }

        function openZoneManagementModal(siteId) {
            const site = sites.find(s => s.id === siteId);
            if (!site) return;

            currentSite = site;
            zones = siteZones[siteId] ? [...siteZones[siteId]] : [];
            document.getElementById("zoneManagementTitle").textContent = `Zone Management - ${site.name}`;
            document.getElementById("zoneManagementModal").classList.add("show");
            renderZoneList();
        }

        function closeZoneManagementModal() {
            document.getElementById("zoneManagementModal").classList.remove("show");
        }

        function renderZoneList() {
            const zoneList = document.getElementById("zoneList");
            const emptyState = document.getElementById("zoneEmptyState");
            zoneList.innerHTML = "";

            if (zones.length === 0) {
                emptyState.style.display = "block";
                return;
            }

            emptyState.style.display = "none";
            zones.forEach(zone => {
                const cameraCount = zone.cameras.length;
                const deterrentCount = zone.deterrents.length;
                const item = document.createElement("div");
                item.className = "zone-list-item";
                item.innerHTML = `
                    <div class="zone-list-title">${zone.name}</div>
                    <div class="zone-list-meta">${zone.id}  ${cameraCount} Cameras  ${deterrentCount} Deterrents</div>
                    <div class="zone-list-actions">
                        <button class="btn btn-primary" onclick="editZone('${zone.id}')">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <button class="btn btn-secondary" onclick="deleteZone('${zone.id}')">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </div>
                `;
                zoneList.appendChild(item);
            });
        }

        function openCreateZoneModal() {
            if (!currentSite) {
                showAlert("Please select a site first.", "warning");
                return;
            }
            currentZoneId = null;
            document.getElementById("modalTitle").textContent = "Create New Zone";
            document.getElementById("zoneName").value = "";
            populateDeviceCheckboxes();
            clearModalErrors();
            document.getElementById("zoneModal").classList.add("show");
        }

        function editZone(zoneId) {
            currentZoneId = zoneId;
            const zone = zones.find(z => z.id === zoneId);
            if (!zone) return;

            document.getElementById("modalTitle").textContent = "Edit Zone";
            document.getElementById("zoneName").value = zone.name;
            populateDeviceCheckboxes(zone);
            clearModalErrors();
            document.getElementById("zoneModal").classList.add("show");
        }

        function populateDeviceCheckboxes(zone = null) {
            const cameraDevices = document.getElementById("cameraDevices");
            const deterrentDevices = document.getElementById("deterrentDevices");

            cameraDevices.innerHTML = devices.cameras.map(camera => {
                const isChecked = zone && zone.cameras.includes(camera.id) ? "checked" : "";
                const isDisabled = zone && !zone.cameras.includes(camera.id) && isDeviceAssignedToOtherZone(camera.id, zone.id) ? "disabled" : "";
                return `
                    <div class="device-checkbox">
                        <input type="checkbox" id="cam_${camera.id}" value="${camera.id}" ${isChecked} ${isDisabled}>
                        <label for="cam_${camera.id}">${camera.name} (${camera.type})</label>
                    </div>
                `;
            }).join("");

            deterrentDevices.innerHTML = devices.deterrents.map(deterrent => {
                const isChecked = zone && zone.deterrents.includes(deterrent.id) ? "checked" : "";
                const isDisabled = zone && !zone.deterrents.includes(deterrent.id) && isDeviceAssignedToOtherZone(deterrent.id, zone.id) ? "disabled" : "";
                return `
                    <div class="device-checkbox">
                        <input type="checkbox" id="det_${deterrent.id}" value="${deterrent.id}" ${isChecked} ${isDisabled}>
                        <label for="det_${deterrent.id}">${deterrent.name} (${deterrent.type})</label>
                    </div>
                `;
            }).join("");
        }

        function isDeviceAssignedToOtherZone(deviceId, currentZoneIdValue) {
            return zones.some(zone =>
                zone.id !== currentZoneIdValue &&
                (zone.cameras.includes(deviceId) || zone.deterrents.includes(deviceId))
            );
        }

        function handleZoneSubmit(event) {
            event.preventDefault();
            clearModalErrors();

            let hasErrors = false;
            const zoneName = document.getElementById("zoneName").value.trim();

            if (!zoneName) {
                showModalError("zoneNameError", "Zone name is required");
                document.getElementById("zoneName").classList.add("error");
                hasErrors = true;
            } else if (zoneName.length < 3) {
                showModalError("zoneNameError", "Zone name must be at least 3 characters long");
                document.getElementById("zoneName").classList.add("error");
                hasErrors = true;
            }

            const selectedCameras = Array.from(document.querySelectorAll("#cameraDevices input[type='checkbox']:checked"))
                .map(cb => cb.value);
            const selectedDeterrents = Array.from(document.querySelectorAll("#deterrentDevices input[type='checkbox']:checked"))
                .map(cb => cb.value);

            if (selectedCameras.length === 0 && selectedDeterrents.length === 0) {
                showModalError("deviceSelectionError", "Please select at least one camera or deterrent device");
                document.querySelector(".device-selection").classList.add("error");
                hasErrors = true;
            }

            const conflicts = checkDeviceConflicts(selectedCameras, selectedDeterrents, currentZoneId);
            if (conflicts.length > 0) {
                showModalAlert(`The following devices are already assigned to other zones: ${conflicts.join(", ")}`, "error");
                hasErrors = true;
            }

            if (hasErrors) return;

            if (currentZoneId) {
                updateZone(currentZoneId, zoneName, selectedCameras, selectedDeterrents);
            } else {
                createZone(zoneName, selectedCameras, selectedDeterrents);
            }
        }

        function checkDeviceConflicts(selectedCameras, selectedDeterrents, currentZoneIdValue) {
            const conflicts = [];
            [...selectedCameras, ...selectedDeterrents].forEach(deviceId => {
                if (isDeviceAssignedToOtherZone(deviceId, currentZoneIdValue)) {
                    conflicts.push(deviceId);
                }
            });
            return conflicts;
        }

        function createZone(name, cameras, deterrents) {
            const newZone = {
                id: "ZONE" + Date.now().toString().slice(-6),
                name: name,
                createdDate: new Date().toISOString(),
                modifiedDate: new Date().toISOString(),
                cameras: cameras,
                deterrents: deterrents
            };

            zones.push(newZone);
            if (currentSite) {
                siteZones[currentSite.id] = zones;
                currentSite.zoneStatus = "configured";
            }

            closeZoneModal();
            renderZoneList();
            refreshConfigList();
            showAlert("Zone created successfully!", "success");
        }

        function updateZone(zoneId, name, cameras, deterrents) {
            const zoneIndex = zones.findIndex(z => z.id === zoneId);
            if (zoneIndex === -1) return;

            zones[zoneIndex] = {
                ...zones[zoneIndex],
                name: name,
                cameras: cameras,
                deterrents: deterrents,
                modifiedDate: new Date().toISOString()
            };

            if (currentSite) {
                siteZones[currentSite.id] = zones;
            }

            closeZoneModal();
            renderZoneList();
            showAlert("Zone updated successfully!", "success");
        }

        function deleteZone(zoneId) {
            const zone = zones.find(z => z.id === zoneId);
            if (!zone) return;

            zoneToDelete = zone;
            document.getElementById("deleteZoneName").textContent = zone.name;
            document.getElementById("deleteModal").classList.add("show");
        }

        function confirmDeleteZone() {
            if (!zoneToDelete) return;

            const zoneIndex = zones.findIndex(z => z.id === zoneToDelete.id);
            if (zoneIndex !== -1) {
                zones.splice(zoneIndex, 1);
                if (currentSite) {
                    siteZones[currentSite.id] = zones;
                    if (zones.length === 0) {
                        currentSite.zoneStatus = "not-configured";
                    }
                }
                closeDeleteModal();
                renderZoneList();
                refreshConfigList();
                showAlert("Zone deleted successfully!", "success");
            }
        }

        function closeZoneModal() {
            document.getElementById("zoneModal").classList.remove("show");
            document.getElementById("zoneForm").reset();
            clearModalErrors();
        }

        function clearModalErrors() {
            document.getElementById("zoneNameError").style.display = "none";
            document.getElementById("deviceSelectionError").style.display = "none";
            document.getElementById("zoneName").classList.remove("error");
            document.querySelector(".device-selection").classList.remove("error");
            document.getElementById("modalAlertContainer").innerHTML = "";
        }

        function showModalError(elementId, message) {
            const errorElement = document.getElementById(elementId);
            errorElement.innerHTML = `<i class="fas fa-exclamation-circle"></i> ${message}`;
            errorElement.style.display = "flex";
        }

        function showModalAlert(message, type) {
            const alertContainer = document.getElementById("modalAlertContainer");
            const alert = document.createElement("div");
            alert.className = `alert alert-${type}`;
            alert.innerHTML = `
                <i class="fas fa-${type === "success" ? "check-circle" : type === "error" ? "exclamation-circle" : "exclamation-triangle"}"></i>
                ${message}
            `;
            alertContainer.appendChild(alert);
            setTimeout(() => alert.remove(), 5000);
        }

        function closeDeleteModal() {
            document.getElementById("deleteModal").classList.remove("show");
            zoneToDelete = null;
        }

        function showAlert(message, type) {
            const alertContainer = document.getElementById("alertContainer");
            const alert = document.createElement("div");
            alert.className = `alert alert-${type}`;
            alert.innerHTML = `
                <i class="fas fa-${type === "success" ? "check-circle" : type === "error" ? "exclamation-circle" : "exclamation-triangle"}"></i>
                ${message}
            `;
            alertContainer.appendChild(alert);
            setTimeout(() => alert.remove(), 5000);
        }

        window.onclick = function(event) {
            const zoneModal = document.getElementById("zoneModal");
            const deleteModal = document.getElementById("deleteModal");
            const zoneManagementModal = document.getElementById("zoneManagementModal");
            const nonConfiguredModal = document.getElementById("nonConfiguredModal");

            if (event.target === zoneModal) closeZoneModal();
            if (event.target === deleteModal) closeDeleteModal();
            if (event.target === zoneManagementModal) closeZoneManagementModal();
            if (event.target === nonConfiguredModal) closeNonConfiguredModal();
        };
    </script>
</body>
</html>
